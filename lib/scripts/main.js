function showvalue(a){measurevalue.innerHTML="Value: "+a}function handleFileSelect(a){for(var b,c=a.target.files,d=0;b=c[d];d++){var e=new FileReader;e.customsize=sizes[c[d].name],e.onload=function(a){var b=new Uint16Array(a.target.result);plot.setData(b,this.customsize.width,this.customsize.height),plot.render(),drawHistogram(calculateHistogram(plot.getData(),[min_range,max_range],histogram_buckets))},e.onerror=function(a){console.error(a)},e.readAsArrayBuffer(b)}}function handleProductSelect(a){var b="http://localhost:8080/ows?service=WPS&version=1.0.0&request=Execute&identifier=getArrayBuffer&DataInputs=coverage_id="+this.value+"&rawdataoutput=output";httpGetAsync(b,function(a){var b=new Float32Array(a),c=b.length;plot=new plotty2.plot(el,b,b[c-2],b[c-1],document.getElementById("rainbow"),[min_range,max_range]),plot.setScale(colorscales.viridis),plot.setClamp(!0),plot.render(),drawHistogram(calculateHistogram(plot.getData(),[min_range,max_range],histogram_buckets))})}function calculateHistogram(a,b,c){for(var d=b[0],e=b[1],f=e-d,g=new Array(c),h=0;c>h;++h)g[h]=0;for(var h=0;h<a.length;++h){var i=a[h];if(!(d>i||i>=e)){var j=Math.round((i-d)/f*(c-1));g[j]+=1}}return drawHistogram(g),g}function drawHistogram(a){var b=document.getElementById("histogram"),c=b.getContext("2d"),d=Math.max.apply(null,a),e=b.width,f=b.height;c.clearRect(0,0,e,f),c.beginPath(),c.moveTo(0,a[0]/d*f),a.forEach(function(b,g){var h=g/a.length*e,i=b/d*f;c.lineTo(h,i),c.stroke()}),c.closePath()}var width=1354,height=2030,sizes={"FSL_2015051619.blob":{width:1354,height:2030},"FSL_2015051634.blob":{width:1354,height:2030},"LST_2015051637.blob":{width:1354,height:2030},"LST_2015051638.blob":{width:1354,height:2030},"LST_2015051822.blob":{width:1354,height:2030},"LST_201505182256.blob":{width:1354,height:2030}},min_range=11e3,max_range=13e3,lastupdate=(new Date).getTime(),now=null,rendertime=0,looptime=0,plot=!1,colorscale_id=!1,histogram_buckets=50,el=document.getElementById("canvas"),min_range_slider=document.getElementById("min"),max_range_slider=document.getElementById("max");min_range_slider.max=max_range,min_range_slider.min=min_range,min_range_slider.value=min_range;var min_label=document.getElementById("min_label");min_label.innerHTML=min_range,max_range_slider.max=max_range,max_range_slider.min=min_range,max_range_slider.value=max_range;var max_label=document.getElementById("max_label");max_label.innerHTML=max_range;var measurevalue=document.getElementById("measurevalue");document.getElementById("files").addEventListener("change",handleFileSelect,!1),document.getElementById("productselect").addEventListener("change",handleProductSelect,!1);var ex_width=100,ex_height=100,exampledata=new Float32Array(ex_height*ex_width),xoff=ex_width/3,yoff=ex_height/3,xhr=new XMLHttpRequest;xhr.open("GET","data/FSL_2015051619.blob",!0),xhr.responseType="arraybuffer",plotty.addColorScale("test",["#00ff00","#ff0000"],[0,1]),xhr.onload=function(a){var b=new Uint16Array(this.response);plot=new plotty.plot(el,b,1354,2030,[min_range,max_range],"viridis",!1),plot.render()},xhr.send(),min_range_slider.oninput=function(){plot&&(min_range=parseFloat(this.value),min_label.innerHTML=min_range,plot.setDomain([min_range,max_range],3),plot.render())},min_range_slider.onchange=function(){plot&&(now=(new Date).getTime(),min_range=parseFloat(this.value),plot.setDomain([min_range,max_range],3),plot.render())},max_range_slider.oninput=function(){plot&&(max_range=parseFloat(this.value),max_label.innerHTML=max_range,plot.setDomain([min_range,max_range],3),plot.render())},max_range_slider.onchange=function(){plot&&(max_range=parseFloat(this.value),plot.setDomain([min_range,max_range],3),plot.render())},colorscaleselect.onchange=function(){colorscale_id=this.value,plot&&(plot.setColorScale(colorscale_id),plot.render())};